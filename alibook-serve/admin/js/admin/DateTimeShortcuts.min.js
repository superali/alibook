!function(){"use strict";var e={calendars:[],calendarInputs:[],clockInputs:[],clockHours:{default_:[[gettext_noop("Now"),-1],[gettext_noop("Midnight"),0],[gettext_noop("6 a.m."),6],[gettext_noop("Noon"),12],[gettext_noop("6 p.m."),18]]},dismissClockFunc:[],dismissCalendarFunc:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",timezoneWarningClass:"timezonewarning",timezoneOffset:0,init:function(){var t=document.getElementsByTagName("body")[0].getAttribute("data-admin-utc-offset");if(t){var n=-60*(new Date).getTimezoneOffset();e.timezoneOffset=n-t}for(var a=document.getElementsByTagName("input"),i=0;i<a.length;i++){var c=a[i];"text"===c.getAttribute("type")&&c.className.match(/vTimeField/)?(e.addClock(c),e.addTimezoneWarning(c)):"text"===c.getAttribute("type")&&c.className.match(/vDateField/)&&(e.addCalendar(c),e.addTimezoneWarning(c))}},now:function(){var e=document.getElementsByTagName("body")[0].getAttribute("data-admin-utc-offset");if(e){var t=new Date,n=-60*t.getTimezoneOffset();return t.setTime(t.getTime()+1e3*(e-n)),t}return new Date},addTimezoneWarning:function(t){var n=django.jQuery,a=e.timezoneWarningClass,i=e.timezoneOffset/3600;if(i&&!n(t).siblings("."+a).length){var c;i>0?c=ngettext("Note: You are %s hour ahead of server time.","Note: You are %s hours ahead of server time.",i):(i*=-1,c=ngettext("Note: You are %s hour behind server time.","Note: You are %s hours behind server time.",i)),c=interpolate(c,[i]);var d=n("<span>");d.attr("class",a),d.text(c),n(t).parent().append(n("<br>")).append(d)}},addClock:function(t){var n=e.clockInputs.length;e.clockInputs[n]=t,e.dismissClockFunc[n]=function(){return e.dismissClock(n),!0};var a=document.createElement("span");a.className=e.shortCutsClass,t.parentNode.insertBefore(a,t.nextSibling);var i=document.createElement("a");i.setAttribute("href","#"),i.appendChild(document.createTextNode(gettext("Now"))),i.addEventListener("click",function(t){t.preventDefault(),e.handleClockQuicklink(n,-1)});var c=document.createElement("a");c.setAttribute("href","#"),c.id=e.clockLinkName+n,c.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.openClock(n)}),quickElement("span",c,"","class","clock-icon","title",gettext("Choose a Time")),a.appendChild(document.createTextNode(" ")),a.appendChild(i),a.appendChild(document.createTextNode(" | ")),a.appendChild(c);var d=document.createElement("div");d.style.display="none",d.style.position="absolute",d.className="clockbox module",d.setAttribute("id",e.clockDivName+n),document.body.appendChild(d),d.addEventListener("click",function(e){e.stopPropagation()}),quickElement("h2",d,gettext("Choose a time"));var l=quickElement("ul",d);l.className="timelist";var r=void 0===e.clockHours[t.name]?"default_":t.name;e.clockHours[r].forEach(function(t){quickElement("a",quickElement("li",l),gettext(t[0]),"href","#").addEventListener("click",function(a){a.preventDefault(),e.handleClockQuicklink(n,t[1])})});var o=quickElement("p",d);o.className="calendar-cancel";quickElement("a",o,gettext("Cancel"),"href","#").addEventListener("click",function(t){t.preventDefault(),e.dismissClock(n)}),document.addEventListener("keyup",function(t){27===t.which&&(e.dismissClock(n),t.preventDefault())})},openClock:function(t){var n=document.getElementById(e.clockDivName+t),a=document.getElementById(e.clockLinkName+t);"rtl"!==getStyle(document.body,"direction")?n.style.left=findPosX(a)+17+"px":n.style.left=findPosX(a)-110+"px",n.style.top=Math.max(0,findPosY(a)-30)+"px",n.style.display="block",document.addEventListener("click",e.dismissClockFunc[t])},dismissClock:function(t){document.getElementById(e.clockDivName+t).style.display="none",document.removeEventListener("click",e.dismissClockFunc[t])},handleClockQuicklink:function(t,n){var a;a=-1===n?e.now():new Date(1970,1,1,n,0,0,0),e.clockInputs[t].value=a.strftime(get_format("TIME_INPUT_FORMATS")[0]),e.clockInputs[t].focus(),e.dismissClock(t)},addCalendar:function(t){var n=e.calendars.length;e.calendarInputs[n]=t,e.dismissCalendarFunc[n]=function(){return e.dismissCalendar(n),!0};var a=document.createElement("span");a.className=e.shortCutsClass,t.parentNode.insertBefore(a,t.nextSibling);var i=document.createElement("a");i.setAttribute("href","#"),i.appendChild(document.createTextNode(gettext("Today"))),i.addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,0)});var c=document.createElement("a");c.setAttribute("href","#"),c.id=e.calendarLinkName+n,c.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.openCalendar(n)}),quickElement("span",c,"","class","date-icon","title",gettext("Choose a Date")),a.appendChild(document.createTextNode(" ")),a.appendChild(i),a.appendChild(document.createTextNode(" | ")),a.appendChild(c);var d=document.createElement("div");d.style.display="none",d.style.position="absolute",d.className="calendarbox module",d.setAttribute("id",e.calendarDivName1+n),document.body.appendChild(d),d.addEventListener("click",function(e){e.stopPropagation()});var l=quickElement("div",d),r=quickElement("a",l,"<","href","#");r.className="calendarnav-previous",r.addEventListener("click",function(t){t.preventDefault(),e.drawPrev(n)});var o=quickElement("a",l,">","href","#");o.className="calendarnav-next",o.addEventListener("click",function(t){t.preventDefault(),e.drawNext(n)});quickElement("div",d,"","id",e.calendarDivName2+n).className="calendar",e.calendars[n]=new Calendar(e.calendarDivName2+n,e.handleCalendarCallback(n)),e.calendars[n].drawCurrent();var s=quickElement("div",d);s.className="calendar-shortcuts";var u=quickElement("a",s,gettext("Yesterday"),"href","#");u.addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,-1)}),s.appendChild(document.createTextNode(" | ")),(u=quickElement("a",s,gettext("Today"),"href","#")).addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,0)}),s.appendChild(document.createTextNode(" | ")),(u=quickElement("a",s,gettext("Tomorrow"),"href","#")).addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,1)});var m=quickElement("p",d);m.className="calendar-cancel";quickElement("a",m,gettext("Cancel"),"href","#").addEventListener("click",function(t){t.preventDefault(),e.dismissCalendar(n)}),django.jQuery(document).on("keyup",function(t){27===t.which&&(e.dismissCalendar(n),t.preventDefault())})},openCalendar:function(t){var n=document.getElementById(e.calendarDivName1+t),a=document.getElementById(e.calendarLinkName+t),i=e.calendarInputs[t];if(i.value){var c=get_format("DATE_INPUT_FORMATS")[0],d=i.value.strptime(c),l=d.getUTCFullYear(),r=d.getUTCMonth()+1;/\d{4}/.test(l.toString())&&r>=1&&r<=12&&e.calendars[t].drawDate(r,l,d)}"rtl"!==getStyle(document.body,"direction")?n.style.left=findPosX(a)+17+"px":n.style.left=findPosX(a)-180+"px",n.style.top=Math.max(0,findPosY(a)-75)+"px",n.style.display="block",document.addEventListener("click",e.dismissCalendarFunc[t])},dismissCalendar:function(t){document.getElementById(e.calendarDivName1+t).style.display="none",document.removeEventListener("click",e.dismissCalendarFunc[t])},drawPrev:function(t){e.calendars[t].drawPreviousMonth()},drawNext:function(t){e.calendars[t].drawNextMonth()},handleCalendarCallback:function(t){var n=get_format("DATE_INPUT_FORMATS")[0];return n=n.replace("\\","\\\\"),n=n.replace("\r","\\r"),n=n.replace("\n","\\n"),n=n.replace("\t","\\t"),n=n.replace("'","\\'"),function(a,i,c){e.calendarInputs[t].value=new Date(a,i-1,c).strftime(n),e.calendarInputs[t].focus(),document.getElementById(e.calendarDivName1+t).style.display="none"}},handleCalendarQuickLink:function(t,n){var a=e.now();a.setDate(a.getDate()+n),e.calendarInputs[t].value=a.strftime(get_format("DATE_INPUT_FORMATS")[0]),e.calendarInputs[t].focus(),e.dismissCalendar(t)}};window.addEventListener("load",e.init),window.DateTimeShortcuts=e}();